<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>サンディクイズ</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
      background: #f8f9fa;
    }
    h1 {
      text-align: center;
      color: #1e88e5;
      margin-bottom: 30px;
      font-size: 2.2em;
      font-weight: bold;
      letter-spacing: 0.05em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
    }
    .question {
      font-size: 1.4em;
      margin-bottom: 20px;
      background-color: #ffffff;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      border-left: 5px solid #2196f3;
    }
    .options {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }
    .options button {
      cursor: pointer;
      font-size: 1.2em;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      background: linear-gradient(to right, #64b5f6, #42a5f5);
      color: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: background 0.3s ease, transform 0.1s ease;
      width: 80%;
      max-width: 450px;
    }
    .options button:hover {
      background: linear-gradient(to right, #42a5f5, #2196f3);
      transform: scale(1.03);
    }
    .explanation {
      background: #e3f2fd;
      padding: 10px;
      margin-top: 15px;
      border-left: 4px solid #42a5f5;
      border-radius: 4px;
    }
    .correct {
      background: #66bb6a !important;
      color: white !important;
    }
    .incorrect {
      background: #ef5350 !important;
      color: white !important;
    }
    .score {
      margin-top: 10px;
      font-size: 1em;
      color: #333;
    }
    button {
      font-size: 1.2em;
      padding: 12px 24px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>サンディクイズ</h1>
  <div id="quiz"></div>
  <script>
    const questions = [
  { question: "na asti → ______", options: ["naasti", "nāsti", "nāāsti"], answer: 1, explanation: "-a + a は同種母音（Savarna）で ā に融合する。したがって b) nāsti が正解。" },
  { question: "sā api → ______", options: ["sāpi", "sāāpi", "saapi"], answer: 0, explanation: "-ā + a は ā に融合する。したがって a) sāpi が正解。" },
  { question: "asti iha → ______", options: ["astīha", "astiha", "astiīha"], answer: 0, explanation: "-i + ī は ī に融合。したがって a) astīha が正解。" },
  { question: "sādhu uktam → ______", options: ["sādhuuktam", "sādhūktam", "sādhvuktam"], answer: 1, explanation: "-u + u は同種母音（Savarna Sandhi）で ū に融合する。したがって b) sādhūktam が正解。" },
  { question: "kartṛ ṛju → ______", options: ["kartr̥ju", "kartṛṛju", "kartṝju"], answer: 2, explanation: "-ṛ + ṛ は ṝ に融合。したがって c) kartṝju が正解。" },
  { question: "tava icchā → ______", options: ["tavecchā", "tavaicchā", "tavicchā"], answer: 0, explanation: "-a + i は Guṇa で e に。したがって a) tavecchā が正解。" },
  { question: "sā uktvā → ______", options: ["soktvā", "sāuktvā", "sāoktvā"], answer: 0, explanation: "-ā + u は Guṇa で o に。したがって a) soktvā が正解。" },
  { question: "yathā ṛtu → ______", options: ["yathartu", "yathārṭu", "yatharitu"], answer: 0, explanation: "-ā + ṛ は Guṇa で ar に。したがって a) yathartu が正解。" },
  { question: "tava eva → ______", options: ["tavaiva", "taveva", "tavāeva"], answer: 0, explanation: "-a + e は Vṛddhi で ai に。したがって a) tavaiva が正解。" },
  { question: "tava aiśvaryam → ______", options: ["tavaaiśvaryam", "tavaiśvaryam", "tavāiśvaryam"], answer: 1, explanation: "-ā + ai は ai に保持される。したがって b) tavaiśvaryam が正解。" },
  { question: "sā oṣadhiḥ → ______", options: ["sauṣadhiḥ", "sāoṣadhiḥ", "sa oṣadhiḥ"], answer: 0, explanation: "-ā + o は Vṛddhi で au に。したがって a) sauṣadhiḥ が正解。" },
  { question: "tasya autsukyam → ______", options: ["tasyautsukyam", "tasyaautsukyam", "tasyāoutsukyam"], answer: 0, explanation: "-ā + au は Vṛddhi で au に。したがって a) tasyautsukyam が正解。" },
  { question: "nadī eva → ______", options: ["nadyeva", "nadīeva", "nadiveva"], answer: 0, explanation: "-ī + 母音 は y に半母音化。したがって a) nadyeva が正解。" },
  { question: "madhu iva → ______", options: ["madhviva", "madhuiva", "madhūiva"], answer: 0, explanation: "-ū + 母音 は v に半母音化。したがって a) madhviva が正解。" },
  { question: "kartṛ asti → ______", options: ["kartr asti", "kartṛasti", "kartra asti"], answer: 0, explanation: "-ṛ + 母音 は r に半母音化。したがって a) kartr asti が正解。" },
  { question: "te api → ______", options: ["teʼpi", "tepi", "te api"], answer: 0, explanation: "-e + a は a 脱落しアヴァグラハ（ʼ）で表記。したがって a) teʼpi が正解。" },
  { question: "prabho atra → ______", options: ["prabhoʼtra", "prabhoatra", "prabhātra"], answer: 0, explanation: "-o + a は a 脱落しアヴァグラハ。したがって a) prabhoʼtra が正解。" },
  { question: "tau ubhau api → ______", options: ["tāv ubhāv api", "tau ubhauapi", "tāubhāv api"], answer: 0, explanation: "この変化は2段階あります：1) tau → tāv は語形変化、2) ubhau + api は au + a の母音サンディで āv になります。したがって a) tāv ubhāv api が正解。" }
];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function shuffleOptions(q) {
  const originalOptions = q.options.map((opt, i) => ({ text: opt, index: i }));
  shuffle(originalOptions);
  q.shuffled = originalOptions;
  q.shuffledAnswer = originalOptions.findIndex(opt => opt.index === q.answer);
}

shuffle(questions);
questions.forEach(shuffleOptions);

function showQuestion() {
  const q = questions[index];
  quizEl.innerHTML = `
    <div class="question">Q${index + 1}: ${q.question}</div>
    <div class="options">${q.shuffled.map((opt, i) => `<button onclick=\"checkAnswer(${i})\">${String.fromCharCode(97 + i)}) ${opt.text}</button>`).join('')}</div>
    <div id="explanation"></div>
    <div class="score" id="score"></div>
    <button onclick="nextQuestion()" style="margin-top:20px">次の問題</button>
  `;
}

const quizEl = document.getElementById('quiz');
let index = 0;
let correctCount = 0;
let totalAnswered = 0;

function checkAnswer(selected) {
  const q = questions[index];
  q.userAnswer = selected;
  const buttons = document.querySelectorAll('.options button');
  buttons.forEach((btn, i) => {
    btn.disabled = true;
    if (i === selected) {
      if (i === q.shuffledAnswer) {
        btn.classList.remove('incorrect'); btn.classList.add('correct');
      } else {
        btn.classList.remove('correct'); btn.classList.add('incorrect');
      }
    } else if (i === q.shuffledAnswer) {
      btn.classList.add('correct');
    }
  });
  if (selected === q.shuffledAnswer) correctCount++;
  totalAnswered++;
  document.getElementById('explanation').innerHTML = `<div class="explanation">${q.explanation}</div>`;
  document.getElementById('score').textContent = `正解数: ${correctCount} / 解答数: ${totalAnswered}`;
}

function nextQuestion() {
  index++;
  if (index >= questions.length) {
    let rate = correctCount / totalAnswered;
    let color = rate >= 0.9 ? '#16a34a' : rate >= 0.6 ? '#facc15' : '#f87171';
    quizEl.innerHTML = `
      <div style="text-align: center; margin-top: 50px;">
        <h2 style="font-size: 2em; color: ${color};">お疲れさまです。${questions.length}問中、${correctCount}問正解です！</h2>
        <button onclick="retryIncorrect()" style="margin-top: 20px; padding: 10px 20px; font-size: 1em;">間違った問題にもう一度挑戦</button><br>
        <button onclick="location.reload()" style="margin-top: 15px; padding: 10px 20px; font-size: 1em;">もう一度挑戦</button>
      </div>
    `;
  } else {
    showQuestion();
  }
}

function retryIncorrect() {
  const incorrectQuestions = questions.filter((q, i) => {
    const userAnswer = q.userAnswer;
    return userAnswer !== undefined && userAnswer !== q.shuffledAnswer;
  });
  if (incorrectQuestions.length === 0) {
    alert('すべて正解です！');
    return;
  }
  questions.length = 0;
  incorrectQuestions.forEach(q => questions.push(q));
  index = 0;
  correctCount = 0;
  totalAnswered = 0;
  questions.forEach(shuffleOptions);
  showQuestion();
}

showQuestion();
  </script>
</body>
</html>
